<% layout('layouts/boilerplate') -%>

<div class="container py-5" style="max-width: 1100px;">

  <!-- Back link -->
  <a href="/listings" class="text-success fw-semibold text-decoration-none">
    ‚Üê Back to all stays
  </a>

  <div class="row g-5 mt-4">

    <!-- IMAGE -->
    <div class="col-md-7">
      <img
        src="<%= list.image %>"
        alt="<%= list.title %>"
        class="img-fluid rounded-4 shadow-sm w-100"
        style="max-height: 450px; object-fit: cover;"
      />
    </div>

    <!-- DETAILS -->
    <div class="col-md-5">

      <h1 class="fw-bold mb-2"><%= list.title %></h1>

      <p class="text-muted mb-2">
        üìç <%= list.location %>, <%= list.country %>
      </p>

      <p class="price-tag mb-3">
        ‚Çπ <%= list.price.toLocaleString("en-IN") %>
        <span>/ night</span>
      </p>

      <p class="text-secondary mb-4" style="line-height: 1.7;">
        <%= list.description %>
      </p>

      <!-- ACTIONS -->
      <div class="d-flex gap-3">

        <a
          href="/listings/<%= list._id %>/edit"
          class="btn btn-outline-success rounded-pill px-4"
        >
          Edit
        </a>

        <form
          method="POST"
          action="/listings/<%= list._id %>?_method=DELETE"
          onsubmit="return confirm('Are you sure you want to delete this stay?')"
        >
          <button class="btn btn-outline-danger rounded-pill px-4">
            Delete
          </button>
        </form>

      </div>

    </div>

  </div>
</div>

<hr class="my-5">

<!-- ================= Leave a Review (TOP) ================= -->
<section class="container mb-5" style="max-width: 700px;">

  <div class="section-header mb-4">
    <h3 class="section-title">Leave a Review</h3>
    <p class="section-subtitle">Share your experience with this stay</p>
  </div>

  <form
    action="/listings/<%= list._id %>/reviews"
    method="POST"
    class="needs-validation"
    novalidate
  >

    <!-- Rating -->
    <div class="mb-4">
      <label class="form-label fw-semibold d-block">Rating</label>

      <div class="d-flex gap-3">
        <% for (let i = 1; i <= 5; i++) { %>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="review[rating]"
              id="rating-<%= i %>"
              value="<%= i %>"
              required
            >
            <label class="form-check-label" for="rating-<%= i %>">
              <%= i %> 
            </label>
          </div>
        <% } %>
      </div>

      <div class="invalid-feedback">
        Please select a rating.
      </div>
    </div>

    <!-- Comment -->
    <div class="mb-4">
      <label class="form-label fw-semibold">Comment</label>
      <textarea
        name="review[comment]"
        class="form-control rounded-4"
        rows="4"
        placeholder="Write your experience..."
        required
      ></textarea>

      <div class="invalid-feedback">
        Comment is required.
      </div>
    </div>

    <button class="btn btn-success rounded-pill px-5">
      Submit Review
    </button>

  </form>
</section>

<hr class="my-5">

<!-- ================= Reviews List (BELOW) ================= -->
<section class="container mb-5">

  <div class="section-header mb-4">
    <h3 class="section-title">Guest Reviews</h3>
    <p class="section-subtitle">What people say about this stay</p>
  </div>

  <% if (list.reviews && list.reviews.length > 0) { %>
    <div class="row g-4">
      <% for (let review of list.reviews) { %>
        <div class="col-md-6">
          <div class="card p-3 border-0 shadow-sm rounded-4 h-100">

            <!-- Stars -->
            <div class="mb-2">
              <% for (let i = 1; i <= 5; i++) { %>
                <span class="<%= i <= review.rating ? 'text-warning' : 'text-muted' %>">‚òÖ</span>
              <% } %>
            </div>

            <!-- Comment -->
            <p class="mb-2"><%= review.comment %></p>

            <!-- Footer -->
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <%= review.createdAt.toDateString() %>
              </small>

              <!-- Delete Review -->
              <form
                action="/listings/<%= list._id %>/review/<%= review._id %>?_method=DELETE"
                method="POST"
              >
                <button class="btn btn-sm btn-outline-danger rounded-pill">
                  Delete
                </button>
              </form>
            </div>

          </div>
      </div>

      <% } %>
    </div>
  <% } else { %>
    <p class="text-muted">No reviews yet. Be the first to review!</p>
  <% } %>

</section>
